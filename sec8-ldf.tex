\section{Large Data Facility Deployment}\label{large-data-facility-deployment}

Data Facility Deployment

The LSST Data Facility will operate several instances of the LSP services for different use cases within the project and for community data access within the two LSST Data Access Centers. The underlying system software infrastructure for hosting LSP services is Kubernetes.  These services will access batch services and the Data Backbone. Installation of Kubernetes is done with a combination of Puppet scripts to deploy software packages for installation. The Kubernetes “kubeadm” utility is used for configuring Kubernetes, and its network overlay, Weave.  Underlying support services, such as etcd and the local container repository, are also part of this infrastructure.  Security and monitoring software are put in place to supervise the activity of the host systems and containers.

Containers are built using the automated build system.  The containers are placed into local container repositories on Kubernetes test systems where security staff can vet them.  Once security vets these containers, they are deployed to the production container registry.

The LSP services are deployed onto the Kubernetes platform by LDF service production staff.  The containers are deployed using YAML service definition files, referencing the local container repositories.   There are no external dependencies so that in the case of network outages at a site containers can still be deployed, even if the Kubernetes infrastructure needs to be rebuilt. Batch production services are co-located with LSP service instances. Data Backbone endpoint services are set up locally to the Base and the LDF.

Kubernetes releases happen in regular and frequent, intervals.  LDF staff monitor these releases and evaluate the appropriateness of upgrading, balancing any new features we might be able to take advantage of against any disruption or change in users’ workflow. 

There are two types of updates to the software that can take place:  Kubernetes and LSP services.  Updates will be implemented on two test clusters.   The first cluster will be used by system administration to test configurations and system software updates.  The second is used for LSP service development.     

Updates to Kubernetes will first be done on the system administration cluster to verify update procedures. After this has been successfully completed, the update will be done to the LSP development cluster, and regression tests for LSP services will take place.  After this has been verified,  Kubernetes will be upgraded on the production cluster.
 
Updates to LSP services are first done on LSP service development cluster. After all tests have passed, the LSP service updates will be done on the production cluster.

